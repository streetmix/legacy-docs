

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tests &mdash; Streetmix  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/sphinx_prompt_css.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Frontend Tests" href="frontend/" />
    <link rel="prev" title="Content Security Policy" href="../csp/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../" class="icon icon-home"> Streetmix
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Technical manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installing-streetmix/">Installing Streetmix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/">Project organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../csp/">Content Security Policy</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="frontend/">Frontend Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tests-locally">Running tests locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frameworks">Frameworks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#unit-and-integration-tests">Unit and integration tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#end-to-end-tests">End-to-end tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linting">Linting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#type-safety">Type safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-testing">Device testing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#continuous-integration-ci">Continuous integration (CI)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting-ci">Troubleshooting CI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#skipping-ci">Skipping CI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#automatic-deployment">Automatic deployment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#github-checks">GitHub checks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#codeclimate">CodeClimate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#codecov">Codecov</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../segment-definitions/">Segment definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environs/">Environs definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/">Helpers and utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support/">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guidebook/">Guidebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact/">Contact</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Streetmix</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../">Docs</a> &raquo;</li>
        
          <li><a href="../">Technical manual</a> &raquo;</li>
        
      <li>Tests</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/technical/tests/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last"><strong>(August 2021) Streetmix documentation has now moved!</strong> Please update your bookmarks to <a class="reference external" href="https://docs.streetmix.net/">https://docs.streetmix.net/</a>.</p>
</div>
<div class="section" id="tests">
<h1>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>Tests are extremely important to the health and stability of Streetmix. We have established some systems and processes to help ensure the ongoing reliability of our platform.</p>
<p>We do not have a strict test-driven development (TDD) methodology, although individual engineers may use this approach if that’s the development pattern they are most comfortable with. Also, while we do measure code coverage, our goal is not necessarily to reach 100%. We’re looking for “enough” coverage to have confidence that new features or refactoring will not create new bugs, which can be more of a subjective approach. As Guillermo Rauch says, <a class="reference external" href="https://twitter.com/rauchg/status/807626710350839808">“Write tests. Not too many. Mostly integration.”</a></p>
<div class="admonition-for-context admonition">
<p class="first admonition-title">For context…</p>
<p class="last">We did not have <em>any</em> test infrastructure in the early phases of Streetmix. Tests have been added over time and are constantly improving. This document reflects our current thoughts about <em>how</em> we should test, but you’ll find lots of moments in the codebase where tests are incomplete or non-existent. We could always use some help with writing tests!</p>
</div>
<div class="section" id="running-tests-locally">
<span id="running-tests"></span><h2>Running tests locally<a class="headerlink" href="#running-tests-locally" title="Permalink to this headline">¶</a></h2>
<p>When testing in a local development environment, only <a class="reference internal" href="#linting"><span class="std std-ref">linting</span></a> and <a class="reference internal" href="#unit-tests"><span class="std std-ref">unit tests</span></a> are run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">npm <span class="nb">test</span></span>
</pre></div></div><p>Full integration tests happen in our continuous integration infrastructure. You’re not required to run this locally, but if you’d like, you can do so with this command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">npm cypress:run</span>
</pre></div></div></div>
<div class="section" id="frameworks">
<h2>Frameworks<a class="headerlink" href="#frameworks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="unit-and-integration-tests">
<span id="unit-tests"></span><h3>Unit and integration tests<a class="headerlink" href="#unit-and-integration-tests" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This section is incomplete and should be expanded.</p>
</div>
<p>Our primary test framework is the <a class="reference external" href="https://jestjs.io/">Jest</a> test runner with <a class="reference external" href="https://testing-library.com/docs/react-testing-library/intro">React Testing Library (RTL)</a>. (These do not do the same thing and are not interchangeable; these two systems work closely together to provide a full unit and integration test environment.) A number of resources already exist that fully document why and how we use these, see the resources list just below.</p>
<p>Our goal is to be as close as possible to a community-designed “best practice” in order to simplify our understanding and comprehension of tests; <em>do not do anything exotic in these tests if you can avoid it.</em></p>
<div class="section" id="resources">
<h4>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://kentcdodds.com/blog/introducing-the-react-testing-library">Introducing the react-testing-library</a> [Kent C. Dodds] - why RTL instead of Enzyme?</li>
<li><a class="reference external" href="https://www.robinwieruch.de/react-testing-library">How to use React Testing Library Tutorial</a> [Robin Wieruch] - start here for the basics</li>
<li><a class="reference external" href="https://kentcdodds.com/blog/common-mistakes-with-react-testing-library">Common mistakes with React Testing Library</a> [Kent C. Dodds]</li>
</ul>
</div>
</div>
<div class="section" id="end-to-end-tests">
<span id="e2e-tests"></span><h3>End-to-end tests<a class="headerlink" href="#end-to-end-tests" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This section is incomplete and should be expanded.</p>
</div>
<p>We use <a class="reference external" href="https://www.cypress.io/">Cypress</a> sparingly. We do eventually want more tests to exist in Cypress, when appropriate, and can replace the unit or integration tests that end-to-end tests can cover.</p>
<p>Cypress only runs in <a class="reference internal" href="#continuous-integration"><span class="std std-ref">our automated continuous integration test environment</span></a> by default, but can also be run locally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">npm run cypress:run</span>
</pre></div></div></div>
<div class="section" id="linting">
<span id="id1"></span><h3>Linting<a class="headerlink" href="#linting" title="Permalink to this headline">¶</a></h3>
<p>We use <a class="reference external" href="https://eslint.org/">ESLint</a> and <a class="reference external" href="https://stylelint.io/">Stylelint</a> to lint JavaScript and CSS, respectively. There is a commit hook that automatically runs the linter on each commit. If the lint fails, you will need to fix your code and try your commit again, or force it to ignore the lint errors. For more on code style, see <a class="reference internal" href="../../contributing/code/styleguide/#code-styleguide"><span class="std std-ref">Code styleguide</span></a>.</p>
<div class="admonition-in-the-future admonition">
<p class="first admonition-title">In the future…</p>
<p class="last">…we may adopt <a class="reference external" href="https://github.com/prettier/prettier">Prettier</a> (or <a class="reference external" href="https://github.com/sheerun/prettier-standard">prettier-standard</a>) to automatically format code. We have not introduced it yet because doing so across the entire codebase would be disruptive to existing work. We currently use Prettier to lint and format JSON. If someone wants to champion adoption of Prettier, please get in touch.</p>
</div>
</div>
<div class="section" id="type-safety">
<h3>Type safety<a class="headerlink" href="#type-safety" title="Permalink to this headline">¶</a></h3>
<p>JavaScript is notoriously not type safe: you may pass any type of object or JavaScript primitive to any function or method, which may not be able to handle them. Or you may write a function that returns values of different types, and the calling script wasn’t expecting that return value. Various attempts to introduce type safety on top of JavaScript have entered the ecosystem, and here’s how we use these tools.</p>
<div class="section" id="proptypes-react">
<h4>PropTypes (React)<a class="headerlink" href="#proptypes-react" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://reactjs.org/docs/typechecking-with-proptypes.html">PropTypes</a> is a runtime typechecking library used for React development. Because it is a runtime checker, PropTypes will only throw errors in the console when running in the browser or in test suites. (The PropTypes library is not compiled into production code.)</p>
<p>We currently enforce using PropTypes for React components in development. This means that React components must declare all of its props and what types of values that prop should be. The benefit of this approach is that React components self-document what props it accepts. Sometimes, a prop can be overloaded with multiple types, but this is generally discouraged if you can avoid it.</p>
</div>
<div class="section" id="typescript">
<h4>TypeScript<a class="headerlink" href="#typescript" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://www.typescriptlang.org/">TypeScript</a> is an extension of the JavaScript language that allows types to be checked statically (that is, reason about whether the right types are being passed around, without having to run the code itself). It’s been growing steadily in popularity (based the <a class="reference external" href="https://2018.stateofjs.com/javascript-flavors/typescript/">State of JS 2018 report</a>) over the past few years.</p>
<p>We have experimented with TypeScript in auxiliary codebases, but we’ve not incorporated it into Streetmix itself. Because we already compile code with Babel, adopting TypeScript piecemeal is doable. However, we have not yet run into a situation where the solution is specifically to adopt TypeScript. That being said, if and when a good case can be made for adopting it, we will likely jump on board. If a migration to TypeScript occurs in React components, it will supercede using PropTypes.</p>
</div>
</div>
<div class="section" id="device-testing">
<h3>Device testing<a class="headerlink" href="#device-testing" title="Permalink to this headline">¶</a></h3>
<p>We do not currently implement device testing, but this is on our to-do list. We have a <a class="reference external" href="https://www.browserstack.com/">Browserstack</a> account for this purpose.</p>
</div>
</div>
<div class="section" id="continuous-integration-ci">
<span id="continuous-integration"></span><h2>Continuous integration (CI)<a class="headerlink" href="#continuous-integration-ci" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="https://travis-ci.org/streetmix/streetmix">Travis CI</a> to automatically run tests for every commit and pull request to our repository.</p>
<div class="section" id="troubleshooting-ci">
<h3>Troubleshooting CI<a class="headerlink" href="#troubleshooting-ci" title="Permalink to this headline">¶</a></h3>
<p>Continuous integration testing is, unfortunately, not deterministic. Because there are various moving parts and third party services involved, CI can sometimes fail, despite the code running perfectly locally (or even in production)! When CI fails, we need to examine why. <strong>Passing CI is almost always required to maintain confidence that a deploy will not break the production site.</strong></p>
<p>Even after determining that CI is failing not because of a bug or linting problem, here are some common tips for addressing issues with the CI infrastructure.</p>
<ol class="arabic simple">
<li><strong>Try running the build again.</strong> Because CI isn’t deterministic, sometimes running it a second time with no changes will cause it to pass. This is commonly the issue when the Selenium smoke test fails.</li>
<li><strong>Check the status of third-party services.</strong> Sometimes, TravisCI itself has issues, so also be sure to check <a class="reference external" href="https://www.traviscistatus.com/">TravisCI status</a>.</li>
</ol>
</div>
<div class="section" id="skipping-ci">
<h3>Skipping CI<a class="headerlink" href="#skipping-ci" title="Permalink to this headline">¶</a></h3>
<p>CI can be skipped by appending <code class="docutils literal notranslate"><span class="pre">[skip</span> <span class="pre">ci]</span></code> to a commit message.</p>
</div>
<div class="section" id="automatic-deployment">
<h3>Automatic deployment<a class="headerlink" href="#automatic-deployment" title="Permalink to this headline">¶</a></h3>
<p>Every commit or merged pull request to the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch that passes CI is automatically deployed to the staging server.</p>
<p>Currently, there is no automatic deployment to the production server. We’ve noticed that each deploy introduces a small amount of lag while the server software restarts. As a result, we now manually trigger deployments to the production server.</p>
</div>
</div>
<div class="section" id="github-checks">
<h2>GitHub checks<a class="headerlink" href="#github-checks" title="Permalink to this headline">¶</a></h2>
<p>In addition to continuous integration, we use some third-party services to keep an eye on code quality and test coverage. These services should be considered “code smell” detectors, but treat them with a grain of salt. They are not required to pass before merging pull requests.</p>
<div class="section" id="codeclimate">
<h3>CodeClimate<a class="headerlink" href="#codeclimate" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://codeclimate.com/github/streetmix/streetmix">CodeClimate</a> measures <strong>technical debt</strong>, or the long-term maintainability and readability of code. It applies some heuristics to detect and track “code smells,” which are opportunities to refactor code or fix potential bugs. A CodeClimate review is triggered automatically on every pull request, but some of the thresholds it uses are quite arbitrary. Here’s some of the issues are raised, and how we’d address them, in order of increasing severity (as it applies to Streetmix):</p>
<ul class="simple">
<li><strong>Lines of code</strong>. CodeClimate triggers a warning when functions and modules exceed an arbitrary line limit. This means there is a potential opportunity to separate concerns, but we will never enforce this, since we don’t want to encourage “code golf” or quick workarounds instead of actually taking the time to separate logic. If something can be refactored into smaller pieces, but can’t be prioritized immediately, add a <code class="docutils literal notranslate"><span class="pre">TODO</span></code> comment instead. If something doesn’t make sense to shorten, mark the issue as <span class="guilabel">Wontfix</span>.</li>
<li><strong>Duplicate code.</strong> CodeClimate triggers a warning when it detects code that look the same as other code elsewhere. This can be an opportunity to refactor code, but more often than not, CodeClimate is seeing similar-looking boilerplate code or patterns. In this case, mark the issue as <span class="guilabel">Invalid</span>.</li>
<li><strong>Cognitive complexity.</strong> CodeClimate triggers a warning when a function contains too many conditional statements, resulting in complex branching or looping code. Not all code can be made simpler, but you may want to consider whether it can be written diffferently. However, use your best judgment here. If you don’t agree with CodeClimate’s assessment, mark the issue as <span class="guilabel">Wontfix</span>.</li>
<li><strong>TODOs</strong>. CodeClimate tracks when a <code class="docutils literal notranslate"><span class="pre">TODO</span></code> or a <code class="docutils literal notranslate"><span class="pre">FIXME</span></code> comment is written in the code. Because this is a developer’s own judgment call, this takes priority above other issues and should be addressed in the future. Never mark this as <span class="guilabel">Wontfix</span> or <span class="guilabel">Invalid</span>. If it’s no longer valid, instead remove the <code class="docutils literal notranslate"><span class="pre">TODO</span></code> or <code class="docutils literal notranslate"><span class="pre">FIXME</span></code> comment from the code.</li>
</ul>
<p>Issues that should be addressed in the future, but can’t or won’t be addressed immediately, should be marked with <span class="guilabel">Confirmed.</span></p>
<p>In spite of CodeClimate’s warnings, reviewers may approve its review even if the issues it raises are not addressed right away.</p>
</div>
<div class="section" id="codecov">
<h3>Codecov<a class="headerlink" href="#codecov" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://codecov.io/gh/streetmix/streetmix">Codecov</a> measures <a class="reference external" href="https://en.wikipedia.org/wiki/Code_coverage">code coverage</a>, which is the percentage of code that is covered by at least one test suite. This percentage is a commonly used metric that software projects use to show how complete its test suites are. However, the percentage itself is not necessarily a measurement of test <em>quality</em>. As a result, while we strive for higher coverage, 100% is not the goal.</p>
<p>A Codecov review is triggered automatically on every pull request, which allows a reviewer to see at a glance whether a pull request increases or decreases overall code coverage. It fails if a large amount of new code is added without increasing a corresponding amount of test coverage.</p>
<p>Because our test suite coverage is quite low at the moment, it is preferred that all new code and refactored code come with test suite coverage.</p>
</div>
</div>
<div class="section" id="id5">
<h2>Resources<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>These additional resources from the developer community help guide our approach to testing. This is not an exhaustive list, and we’ll keep updating this over time.</p>
<ul class="simple">
<li><a class="reference external" href="https://kentcdodds.com/blog/write-tests/">Write tests. Not too many. Mostly integration.</a> [Kent C. Dodds], on Guillermo Rauch’s tweet.</li>
<li><a class="reference external" href="https://github.com/goldbergyoni/javascript-testing-best-practices">JavaScript &amp; Node.js Testing Best Practices</a> [Yoni Goldberg]</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="frontend/" class="btn btn-neutral float-right" title="Frontend Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../csp/" class="btn btn-neutral float-left" title="Content Security Policy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Streetmix LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>